
<div class="container">
    <div class="panel panel-danger" ng-show="errorMessage">
        <div class="panel-heading">There was an error processing your request.</div>
        <div class="panel-body">{{errorMessage}}</div>
    </div>
    <div class="jumbotron">
        <h2>{{proposal.productName}}</h2>
        <p class="text-muted" ng-show="proposal.mainCategory"><strong>{{proposal.mainCategory}} - {{proposal.subCategory}}</strong></p>
        <p class="text-muted">{{proposal.productDescription}}</p>
        <p class="text-muted" ng-show="proposal.productSku">SKU: {{proposal.productSku}}</p>
        <p class="text-muted" ng-show="proposal.productUnitSize">Unit size: {{proposal.productUnitSize}}</p>

        <span class="small">
            Maximum price the buyers are willing to pay: <span class="text-muted">{{(proposal.maxPrice || 0) | number: 2}} GBP</span>
        </span><br>
        <span class="small">
            End date: <span class="text-muted">{{proposal.endDate | amDateFormat:'DD-MM-YYYY HH:mm:ss'}}</span>
        </span><br>
        <span class="small">
            Ultimate delivery date: <span class="text-muted">{{proposal.ultimateDeliveryDate | amDateFormat:'DD-MM-YYYY HH:mm:ss'}}</span>
        </span><br>
        <h4>Time left to get your orders in:</h4>
        <h1 class="large" ng-cloak ng-show="proposal.endDate"><timer max-time-unit="day" end-time="proposal.endDate">{{ddays}}:{{hhours}}:{{mminutes}}:{{sseconds}}</timer></h1>
        <br><br>
        <p>
            Promote this BuyCo in your network to get more people on board!
        </p>
        <p><a twitter data-lang="en" data-count='horizontal' data-url='{{pageUrl}}' data-size="medium" data-text='Join me to buy {{proposal.productName}} together using @buycoio!'></a></p>
        <span class="small pull-right text-right">Smart Contact Address:<br><span class="text-muted">{{proposal.contractAddress}}</span></span>
        <form role="form" name="proposalForm" novalidate>
            <!-- TODO: only show buy to buyers and offer to sellers -->
            <a href="/proposal/{{proposal.contractAddress}}/back" class="btn btn-primary">
                Buy together
            </a>
            <a class="btn btn-primary" href="/proposal/{{proposal.contractAddress}}/offer/new">
                Make an offer
            </a>
        </form>
    </div>
    <div class="panel panel-default">
        <!-- TODO: show only to the manager of the BuyCo -->
        <div class="panel-heading">
            Management options
        </div>
        <div class="panel-body">
            <p>You are the manager of this BuyCo.</p>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-heading">
            Backers
        </div>
        <div class="panel-body" ng-hide="backers">
            Loading the list of prospective buyers...
        </div>
        <div class="panel-body" ng-show="backers.length == 0">
            <p>You can be the first to back this proposal!</p>
        </div>
        <div class="panel-body" ng-show="backers.length > 0">
            <div class="list-group">
                <p href="#" ng-repeat="backer in backers track by backer.address" class="list-group-item">
                    Address <code>{{backer.address}}</code><span ng-show="backer.startPaymentTransactionId"> (<a href="https://uphold.com/reserve/transactions/{{backer.startPaymentTransactionId}}" target="_blank">see initial payment</a>)</span>:
                    <span class="pull-right text-muted">{{backer.amount}} unit(s)</span>
                    <!--TODO: show Buttons below only after deal has been closed, and only to the
                        specific backer. They lead to a simple form reporting on the quality on the
                        delivery of these goods as yes/no.-->
                    <a href="/proposal/{{proposal.contractAddress}}/delivery" class="btn btn-primary">
                        I've received my goods
                    </a>
                    <a href="/proposal/{{proposal.contractAddress}}/delivery" class="btn btn-danger">
                        I didn't receive the goods in good order
                    </a>
                </p>
            </div>
        </div>
    </div>
    <div class="panel panel-default">
        <!-- TODO: fill data -->
        <div class="panel-heading">
            Payment status
        </div>
        <div class="panel-body">
            <ul>
                <li>N out of M backers have completed the pledge payment</li>
                <li>N out of M backers have completed the start payment</li>
                <li>N out of M backers have completed the final payment</li>
                <li>Total amount in escrow: GBP xx.xx</li>
            </ul>
        </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading">
            Offers
        </div>
        <div class="panel-body" ng-hide="offers">
            Loading the list of offers...
        </div>
        <div class="panel-body" ng-show="offers.length == 0">
            <p>
                We're waiting for the first offer. Promote this BuyCo in your network to get more people on board!
            </p>
            <p><a twitter data-lang="en" data-count='horizontal' data-url='{{pageUrl}}' data-size="medium" data-text='Join me to buy {{proposal.productName}} together using @buycoio!'></a></p>
        </div>
        <div class="panel-body" ng-show="offers.length > 0">
            <div class="list-group">
                <p ng-repeat="offer in offers track by offer.id" class="list-group-item">
                    <!-- TODO: fill in real seller name -->
                    Johnson &amp; Co (<code>{{offer.sellerAddress}}</code>) offers {{(offer.price || 0) | number :2}} GBP <span class="pull-right text-muted">minimum amount {{offer.minimumAmount}} unit(s)</span>
                    <span class="small"><strong>this is the accepted offer</strong></span>
                    <a href="/proposal/{{proposal.contractAddress}}/offer/{{offer.id}}" class="btn btn-primary">
                        See the offer
                    </a>
                </p>
            </div>
        </div>
    </div>
</div>
